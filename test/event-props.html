<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>jQuery Migrate event props iframe test</title>

	<!-- Load a jQuery and jquery-migrate plugin file based on URL -->
	<script src="testinit.js"></script>
	<script>
		TestManager.loadProject( "jquery", "git" );
		// Close this script tag so file will load
	</script>
	<script>
		jQuery.noConflict();
		TestManager.loadProject( "jquery-migrate", "dev", true );
		// Close this script tag so file will load
	</script>
	<script>
		jQuery.migrateMute = true;
		jQuery.migrateReset();

		function dispatchEvent( elem, type ) {
			var e = document.createEvent( "HTMLEvents" );
			e.initEvent( type, true, true );
			elem.dispatchEvent( e );
		}

		function runTest() {
			var div = document.createElement( "div" ),
				$div = jQuery( div ).appendTo( document.body );

			jQuery.event.props.push( "genericProp" );
			jQuery.event.fixHooks[ "excite" ] = {
				props: [ "reallyHappy", "reallySad" ],
				filter: function( event, original ) {
					if ( "reallySad" in event ) {
						event.gotSad = 1;
					}
					if ( "reallyHappy" in event ) {
						event.gotHappy = 2;
					}
					if ( "genericProp" in event ) {
						event.gotProp = 42;
					}
					return event;
				}
			};

			$div.on( "excite", function( event ) {
				var worked =

					// Hooks were called
					event.gotSad === 1 &&
					event.gotHappy === 2 &&
					event.gotProp === 42 &&

					jQuery.event.props.length === 0 &&
					jQuery.event.fixHooks[ "excite" ].props.length === 0;

				parent.TestManager.iframeCallback( worked );
			} );

			dispatchEvent( div, "excite" );
		}

		jQuery( runTest );
	</script>
</head>
<body>
	<p>jQuery Migrate</p>
</body>
</html>
